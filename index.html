<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON to Zod Schema Generator</title>
    <meta name="description"
        content="Generate Zod schemas from JSON with advanced type detection, regex patterns, enums, and more.">
    <script src="https://unpkg.com/prettier@2.3.2/standalone.js"></script>
    <script src="https://unpkg.com/prettier@2.3.2/parser-babel.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script>
        // Init theme early to prevent flash
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }
    </script>
    <style>
        .toggle-checkbox:checked {
            right: 0;
            border-color: #68d391;
        }

        .toggle-checkbox:checked+.toggle-label {
            background-color: #68d391;
        }

        .tooltip {
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .has-tooltip:hover .tooltip {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>

<body
    class="font-sans bg-gray-50 via-gray-100 to-gray-200 dark:bg-gradient-to-br dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 min-h-screen flex flex-col items-center p-8 transition-colors duration-200">
    <div class="fixed top-4 right-4 z-50">
        <button id="themeToggle" onclick="toggleTheme()"
            class="p-2.5 rounded-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 transition-all shadow-lg">
            <!-- Sun icon (for dark mode) -->
            <svg id="themeIconSun" class="w-5 h-5 hidden dark:block" fill="currentColor" viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h1a1 1 0 100 2h-1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
                    fill-rule="evenodd" clip-rule="evenodd"></path>
            </svg>
            <!-- Moon icon (for light mode) -->
            <svg id="themeIconMoon" class="w-5 h-5 block dark:hidden" fill="currentColor" viewBox="0 0 20 20"
                xmlns="http://www.w3.org/2000/svg">
                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path>
            </svg>
        </button>
    </div>
    <div class="w-full max-w-7xl">
        <h1
            class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-purple-600 dark:from-blue-400 dark:to-purple-500 text-center mb-2">
            JSON to Zod Schema Generator
        </h1>
        <p class="text-gray-600 dark:text-gray-400 text-center mb-8">Advanced schema generation with regex patterns,
            enums, and coercion
        </p>

        <!-- Options Panel -->
        <div
            class="bg-white/80 dark:bg-gray-800/50 backdrop-blur-sm p-6 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 mb-8 transition-colors duration-200">
            <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2">
                <svg class="w-5 h-5 text-purple-500 dark:text-purple-400" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z">
                    </path>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                </svg>
                Generation Options
            </h2>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4">
                <!-- Strict Mode -->
                <div class="has-tooltip relative">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="strictMode"
                                class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 border-gray-300 dark:border-gray-600 appearance-none cursor-pointer transition-all duration-200" />
                            <div
                                class="toggle-label block overflow-hidden h-6 w-12 rounded-full bg-gray-300 dark:bg-gray-600 cursor-pointer">
                            </div>
                        </div>
                        <span class="text-gray-700 dark:text-gray-300 text-sm">Strict Mode</span>
                    </label>
                    <span
                        class="tooltip absolute bg-gray-800 dark:bg-gray-900 text-white dark:text-gray-200 text-xs rounded px-2 py-1 -top-8 left-0 whitespace-nowrap z-10 border border-gray-700 dark:border-transparent">
                        Add .strict() to objects
                    </span>
                </div>

                <!-- Coerce Mode -->
                <div class="has-tooltip relative">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="coerceMode"
                                class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 border-gray-300 dark:border-gray-600 appearance-none cursor-pointer transition-all duration-200"
                                checked />
                            <div
                                class="toggle-label block overflow-hidden h-6 w-12 rounded-full bg-gray-300 dark:bg-gray-600 cursor-pointer">
                            </div>
                        </div>
                        <span class="text-gray-700 dark:text-gray-300 text-sm">Coerce Dates</span>
                    </label>
                    <span
                        class="tooltip absolute bg-gray-800 dark:bg-gray-900 text-white dark:text-gray-200 text-xs rounded px-2 py-1 -top-8 left-0 whitespace-nowrap z-10 border border-gray-700 dark:border-transparent">
                        Use z.coerce for dates
                    </span>
                </div>

                <!-- Detect Integers -->
                <div class="has-tooltip relative">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="detectIntegers"
                                class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 border-gray-300 dark:border-gray-600 appearance-none cursor-pointer transition-all duration-200"
                                checked />
                            <div
                                class="toggle-label block overflow-hidden h-6 w-12 rounded-full bg-gray-300 dark:bg-gray-600 cursor-pointer">
                            </div>
                        </div>
                        <span class="text-gray-700 dark:text-gray-300 text-sm">Detect Integers</span>
                    </label>
                    <span
                        class="tooltip absolute bg-gray-800 dark:bg-gray-900 text-white dark:text-gray-200 text-xs rounded px-2 py-1 -top-8 left-0 whitespace-nowrap z-10 border border-gray-700 dark:border-transparent">
                        Use .int() for whole numbers
                    </span>
                </div>

                <!-- Detect Positive/Negative -->
                <div class="has-tooltip relative">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="detectSign"
                                class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 border-gray-300 dark:border-gray-600 appearance-none cursor-pointer transition-all duration-200"
                                checked />
                            <div
                                class="toggle-label block overflow-hidden h-6 w-12 rounded-full bg-gray-300 dark:bg-gray-600 cursor-pointer">
                            </div>
                        </div>
                        <span class="text-gray-700 dark:text-gray-300 text-sm">Detect Sign</span>
                    </label>
                    <span
                        class="tooltip absolute bg-gray-800 dark:bg-gray-900 text-white dark:text-gray-200 text-xs rounded px-2 py-1 -top-8 left-0 whitespace-nowrap z-10 border border-gray-700 dark:border-transparent">
                        Detect positive/negative/nonnegative
                    </span>
                </div>

                <!-- Use Nonempty Arrays -->
                <div class="has-tooltip relative">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="nonemptyArrays"
                                class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 border-gray-300 dark:border-gray-600 appearance-none cursor-pointer transition-all duration-200" />
                            <div
                                class="toggle-label block overflow-hidden h-6 w-12 rounded-full bg-gray-300 dark:bg-gray-600 cursor-pointer">
                            </div>
                        </div>
                        <span class="text-gray-700 dark:text-gray-300 text-sm">N/empty Arrays</span>
                    </label>
                    <span
                        class="tooltip absolute bg-gray-800 dark:bg-gray-900 text-white dark:text-gray-200 text-xs rounded px-2 py-1 -top-8 left-0 whitespace-nowrap z-10 border border-gray-700 dark:border-transparent">
                        Add .nonempty() for arrays with items
                    </span>
                </div>

                <!-- Optional Mode -->
                <div class="has-tooltip relative">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="optionalMode"
                                class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 border-gray-300 dark:border-gray-600 appearance-none cursor-pointer transition-all duration-200" />
                            <div
                                class="toggle-label block overflow-hidden h-6 w-12 rounded-full bg-gray-300 dark:bg-gray-600 cursor-pointer">
                            </div>
                        </div>
                        <span class="text-gray-700 dark:text-gray-300 text-sm">Optional</span>
                    </label>
                    <span
                        class="tooltip absolute bg-gray-800 dark:bg-gray-900 text-white dark:text-gray-200 text-xs rounded px-2 py-1 -top-8 left-0 whitespace-nowrap z-10 border border-gray-700 dark:border-transparent">
                        Add .optional() to schema
                    </span>
                </div>

                <!-- Required Mode -->
                <div class="has-tooltip relative">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <div class="relative">
                            <input type="checkbox" id="requiredMode"
                                class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 border-gray-300 dark:border-gray-600 appearance-none cursor-pointer transition-all duration-200" />
                            <div
                                class="toggle-label block overflow-hidden h-6 w-12 rounded-full bg-gray-300 dark:bg-gray-600 cursor-pointer">
                            </div>
                        </div>
                        <span class="text-gray-700 dark:text-gray-300 text-sm">Required</span>
                    </label>
                    <span
                        class="tooltip absolute bg-gray-800 dark:bg-gray-900 text-white dark:text-gray-200 text-xs rounded px-2 py-1 -top-8 left-0 whitespace-nowrap z-10 border border-gray-700 dark:border-transparent">
                        Add .required() to schema
                    </span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Input Panel -->
            <div
                class="bg-white/80 dark:bg-gray-800/50 backdrop-blur-sm p-6 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 transition-all duration-300 hover:shadow-2xl hover:shadow-blue-500/10">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-500 dark:text-blue-400" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                        </path>
                    </svg>
                    Input JSON
                </h2>
                <div class="h-96 relative">
                    <textarea id="jsonInput"
                        class="w-full h-full p-4 bg-gray-50 dark:bg-gray-900/80 border border-gray-300 dark:border-gray-600 rounded-lg font-mono text-sm text-gray-800 dark:text-gray-200 resize-y focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all placeholder-gray-400 dark:placeholder-gray-500"
                        placeholder="Paste your JSON here..."></textarea>
                </div>
                <div class="flex justify-center mt-4 gap-4">
                    <button
                        class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-medium py-2.5 px-8 rounded-lg shadow-lg shadow-blue-500/25 transition-all duration-300 transform hover:scale-105"
                        onclick="generateSchema()">
                        Generate Schema
                    </button>
                    <button
                        class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium py-2.5 px-6 rounded-lg transition-all duration-300"
                        onclick="loadExample()">
                        Load Example
                    </button>
                </div>
                <div id="inputError" class="text-red-400 mt-3 text-center text-sm"></div>
            </div>

            <!-- Output Panel -->
            <div
                class="bg-white/80 dark:bg-gray-800/50 backdrop-blur-sm p-6 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 transition-all duration-300 hover:shadow-2xl hover:shadow-purple-500/10">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2">
                    <svg class="w-5 h-5 text-purple-500 dark:text-purple-400" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                    </svg>
                    Generated Zod Schema
                </h2>
                <div class="h-96 relative">
                    <textarea id="schemaOutput"
                        class="w-full h-full p-4 bg-gray-50 dark:bg-gray-900/80 border border-gray-300 dark:border-gray-600 rounded-lg font-mono text-sm text-green-600 dark:text-green-400 resize-y cursor-text focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                        readonly placeholder="Generated schema will appear here..."></textarea>
                </div>
                <div class="flex justify-center mt-4 gap-3">
                    <button
                        class="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-medium py-2.5 px-6 rounded-lg shadow-lg shadow-green-500/25 transition-all duration-300 transform hover:scale-105"
                        onclick="downloadSchema()">
                        <span class="flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                            Download
                        </span>
                    </button>
                    <button
                        class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium py-2.5 px-6 rounded-lg transition-all duration-300"
                        onclick="copySchema()">
                        <span class="flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3">
                                </path>
                            </svg>
                            Copy
                        </span>
                    </button>
                    <button
                        class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-700 dark:text-gray-200 font-medium py-2.5 px-6 rounded-lg transition-all duration-300"
                        onclick="clearInputs()">
                        <span class="flex items-center gap-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                                </path>
                            </svg>
                            Clear
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Detected Types Panel -->
        <div id="detectedTypesPanel"
            class="hidden bg-white/80 dark:bg-gray-800/50 backdrop-blur-sm p-6 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 mt-8">
            <h2 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-4 flex items-center gap-2">
                <svg class="w-5 h-5 text-yellow-500 dark:text-yellow-400" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z">
                    </path>
                </svg>
                Detected Patterns
            </h2>
            <div id="detectedTypes" class="flex flex-wrap gap-2"></div>
        </div>
    </div>

    <script>
        // Configuration object for schema generation
        const getConfig = () => ({
            strictMode: document.getElementById('strictMode').checked,
            coerceMode: document.getElementById('coerceMode').checked,
            detectIntegers: document.getElementById('detectIntegers').checked,
            detectSign: document.getElementById('detectSign').checked,
            nonemptyArrays: document.getElementById('nonemptyArrays').checked,
            optionalMode: document.getElementById('optionalMode').checked,
            requiredMode: document.getElementById('requiredMode').checked
        });

        // Pattern definitions for string type detection
        const stringPatterns = [
            // Built-in Zod validations
            { name: 'UUID', regex: /^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i, zod: 'z.guid()' },
            { name: 'Email', regex: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/, zod: 'z.email()' },
            { name: 'URL', regex: /^(https?:\/\/|data:)[^\s]+$/, zod: 'z.url()' },
            { name: 'CUID', regex: /^c[a-z0-9]{24}$/, zod: 'z.cuid()' },
            { name: 'CUID2', regex: /^[a-z][a-z0-9]{23}$/, zod: 'z.cuid2()' },
            { name: 'ULID', regex: /^[0-7][0-9A-HJKMNP-TV-Z]{25}$/i, zod: 'z.ulid()' },
            { name: 'NanoID', regex: /^[A-Za-z0-9_-]{21}$/, zod: 'z.nanoid()' },
            { name: 'Base64', regex: /^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/, zod: 'z.base64()', minLength: 16 },
            { name: 'Emoji', regex: /^[\p{Extended_Pictographic}]+$/u, zod: 'z.emoji()' },

            // IP addresses
            { name: 'IPv4', regex: /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/, zod: 'z.ipv4()' },
            { name: 'IPv6', regex: /^(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$/, zod: 'z.ipv6()' },

            // Date/Time patterns - comprehensive date format support with regex
            { name: 'ISO DateTime', regex: /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(\.\d+)?(Z|[+-]\d{2}:\d{2})?$/, zod: "z.string().regex(/^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(Z|[+-]\\d{2}:\\d{2})?$/, 'Invalid ISO datetime')" },
            { name: 'Date YYYY-MM-DD', regex: /^\d{4}-\d{2}-\d{2}$/, zod: "z.string().regex(/^\\d{4}-\\d{2}-\\d{2}$/, 'Invalid date (YYYY-MM-DD)')" },
            { name: 'Date YYYY/MM/DD', regex: /^\d{4}\/\d{2}\/\d{2}$/, zod: "z.string().regex(/^\\d{4}\\/\\d{2}\\/\\d{2}$/, 'Invalid date (YYYY/MM/DD)')" },
            { name: 'Date DD-MM-YYYY', regex: /^\d{2}-\d{2}-\d{4}$/, zod: "z.string().regex(/^\\d{2}-\\d{2}-\\d{4}$/, 'Invalid date (DD-MM-YYYY)')" },
            { name: 'Date DD/MM/YYYY', regex: /^\d{2}\/\d{2}\/\d{4}$/, zod: "z.string().regex(/^\\d{2}\\/\\d{2}\\/\\d{4}$/, 'Invalid date (DD/MM/YYYY)')" },
            { name: 'Date DD.MM.YYYY', regex: /^\d{2}\.\d{2}\.\d{4}$/, zod: "z.string().regex(/^\\d{2}\\.\\d{2}\\.\\d{4}$/, 'Invalid date (DD.MM.YYYY)')" },
            { name: 'DateTime YYYY-MM-DD HH:MM:SS', regex: /^\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}$/, zod: "z.string().regex(/^\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2}$/, 'Invalid datetime (YYYY-MM-DD HH:MM:SS)')" },
            { name: 'DateTime DD/MM/YYYY HH:MM:SS', regex: /^\d{2}\/\d{2}\/\d{4} \d{2}:\d{2}:\d{2}$/, zod: "z.string().regex(/^\\d{2}\\/\\d{2}\\/\\d{4} \\d{2}:\\d{2}:\\d{2}$/, 'Invalid datetime (DD/MM/YYYY HH:MM:SS)')" },
            { name: 'DateTime DD-MM-YYYY HH:MM:SS', regex: /^\d{2}-\d{2}-\d{4} \d{2}:\d{2}:\d{2}$/, zod: "z.string().regex(/^\\d{2}-\\d{2}-\\d{4} \\d{2}:\\d{2}:\\d{2}$/, 'Invalid datetime (DD-MM-YYYY HH:MM:SS)')" },
            { name: 'DateTime DD.MM.YYYY HH:MM:SS', regex: /^\d{2}\.\d{2}\.\d{4} \d{2}:\d{2}:\d{2}$/, zod: "z.string().regex(/^\\d{2}\\.\\d{2}\\.\\d{4} \\d{2}:\\d{2}:\\d{2}$/, 'Invalid datetime (DD.MM.YYYY HH:MM:SS)')" },
            { name: 'Time HH:MM:SS', regex: /^\d{2}:\d{2}:\d{2}(\.\d+)?$/, zod: "z.string().regex(/^\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?$/, 'Invalid time (HH:MM:SS)')" },
            { name: 'Time HH:MM', regex: /^\d{2}:\d{2}$/, zod: "z.string().regex(/^\\d{2}:\\d{2}$/, 'Invalid time (HH:MM)')" },
            { name: 'Duration ISO8601', regex: /^P(?:\d+Y)?(?:\d+M)?(?:\d+W)?(?:\d+D)?(?:T(?:\d+H)?(?:\d+M)?(?:\d+S)?)?$/, zod: 'z.string().duration()' },
            { name: 'Unix Timestamp', regex: /^\d{10}$/, zod: "z.string().regex(/^\\d{10}$/, 'Unix timestamp')" },
            { name: 'Unix Timestamp MS', regex: /^\d{13}$/, zod: "z.string().regex(/^\\d{13}$/, 'Unix timestamp (ms)')" },

            // Custom regex patterns
            { name: 'Phone', regex: /^\+?[1-9]\d{6,14}$/, zod: "z.string().regex(/^\\+?[1-9]\\d{6,14}$/, 'Invalid phone number')" },
            { name: 'Decimal', regex: /^\d+\.\d+$/, zod: "z.string().regex(/^\\d+\\.\\d+$/)" },
            { name: 'Numeric', regex: /^\d+$/, zod: "z.string().regex(/^\\d+$/)" },
            { name: 'Credit Card', regex: /^\d{13,19}$/, zod: "z.string().regex(/^\\d{13,19}$/, 'Invalid credit card number')" },
            { name: 'Hex Color', regex: /^#[0-9A-Fa-f]{6}$/, zod: "z.string().regex(/^#[0-9A-Fa-f]{6}$/, 'Invalid hex color')" },
            { name: 'Hex Color Short', regex: /^#[0-9A-Fa-f]{3}$/, zod: "z.string().regex(/^#[0-9A-Fa-f]{3}$/, 'Invalid hex color')" },
            { name: 'RGB', regex: /^rgb\(\s*\d{1,3}\s*,\s*\d{1,3}\s*,\s*\d{1,3}\s*\)$/, zod: "z.string().regex(/^rgb\\(\\s*\\d{1,3}\\s*,\\s*\\d{1,3}\\s*,\\s*\\d{1,3}\\s*\\)$/, 'Invalid RGB color')" },
            { name: 'HSL', regex: /^hsl\(\s*\d{1,3}\s*,\s*\d{1,3}%\s*,\s*\d{1,3}%\s*\)$/, zod: "z.string().regex(/^hsl\\(\\s*\\d{1,3}\\s*,\\s*\\d{1,3}%\\s*,\\s*\\d{1,3}%\\s*\\)$/, 'Invalid HSL color')" },
            { name: 'JWT', regex: /^eyJ[A-Za-z0-9-_]+\.eyJ[A-Za-z0-9-_]+\.[A-Za-z0-9-_.+/=]*$/, zod: "z.string().regex(/^eyJ[A-Za-z0-9-_]+\\.eyJ[A-Za-z0-9-_]+\\.[A-Za-z0-9-_.+\\/=]*$/, 'Invalid JWT token')" },
            { name: 'Semver', regex: /^\d+\.\d+\.\d+(-[a-zA-Z0-9.]+)?(\+[a-zA-Z0-9.]+)?$/, zod: "z.string().regex(/^\\d+\\.\\d+\\.\\d+(-[a-zA-Z0-9.]+)?(\\+[a-zA-Z0-9.]+)?$/, 'Invalid semantic version')" },
            { name: 'MAC Address', regex: /^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/, zod: "z.string().regex(/^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$/, 'Invalid MAC address')" },
            { name: 'Slug', regex: /^[a-z0-9]+(?:-[a-z0-9]+)*$/, zod: "z.string().regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/, 'Invalid slug')" },
            { name: 'MongoDB ObjectId', regex: /^[0-9a-fA-F]{24}$/, zod: "z.string().regex(/^[0-9a-fA-F]{24}$/, 'Invalid MongoDB ObjectId')" },
            { name: 'Latitude', regex: /^(\+|-)?(?:90(?:(?:\.0{1,6})?)|(?:[0-9]|[1-8][0-9])(?:(?:\.[0-9]{1,6})?))$/, zod: "z.string().regex(/^-?([1-8]?\\d\\.\\d+|90\\.0+)$/, 'Invalid latitude')" },
            { name: 'Longitude', regex: /^(\+|-)?(?:180(?:(?:\.0{1,6})?)|(?:[0-9]|[1-9][0-9]|1[0-7][0-9])(?:(?:\.[0-9]{1,6})?))$/, zod: "z.string().regex(/^-?(180\\.0+|((1[0-7]\\d)|([1-9]?\\d))\\.\\d+)$/, 'Invalid longitude')" },
            { name: 'Currency Code', regex: /^[A-Z]{3}$/, zod: "z.string().length(3).regex(/^[A-Z]{3}$/, 'Invalid currency code')" },
            { name: 'Locale', regex: /^[a-z]{2}(-[A-Z]{2})?$/, zod: "z.string().regex(/^[a-z]{2}(-[A-Z]{2})?$/, 'Invalid locale')" },
        ];

        // Track detected patterns for display
        let detectedPatternsSet = new Set();

        function detectStringPattern(str, config) {
            for (const pattern of stringPatterns) {
                // Skip base64 check for short strings (avoid false positives)
                if (pattern.minLength && str.length < pattern.minLength) continue;

                if (pattern.regex.test(str)) {
                    detectedPatternsSet.add(pattern.name);
                    return pattern.zod;
                }
            }



            // Numeric String (fallback for non-matched numbers like "190")
            if (/^\d+$/.test(str)) {
                return `z.string().regex(/^\\d{${str.length}}$/)`;
            }

            // Decimal String (fallback for non-matched decimals like "12.34")
            if (/^\d+\.\d+$/.test(str)) {
                const decimalPart = str.split('.')[1];
                return `z.string().regex(/^\\d+\\.\\d{${decimalPart.length}}$/)`;
            }

            // Default string with min length
            return str.length > 0 ? 'z.string().min(1)' : 'z.string()';
        }

        function parseNumber(num, config) {
            let result = 'z.number()';
            const refinements = [];

            // Detect integer
            if (config.detectIntegers && Number.isInteger(num)) {
                refinements.push('.int()');
            }

            // Detect sign constraints
            if (config.detectSign) {
                if (num > 0) {
                    refinements.push('.positive()');
                } else if (num < 0) {
                    refinements.push('.negative()');
                } else if (num === 0) {
                    refinements.push('.nonnegative()');
                }
            }

            // Detect safe integer
            if (num > Number.MAX_SAFE_INTEGER || num < Number.MIN_SAFE_INTEGER) {
                refinements.push('.safe()');
            }

            // Detect finite
            if (!Number.isFinite(num)) {
                return 'z.number()'; // Just base number for infinity
            }

            return result + refinements.join('');
        }

        function detectEnumValues(values) {
            // Check if all values are strings and there are fewer than 20 unique values
            const uniqueValues = [...new Set(values)];
            if (uniqueValues.length <= 10 && uniqueValues.every(v => typeof v === 'string') && uniqueValues.length >= 2) {
                const escapedValues = uniqueValues.map(v => `'${v.replace(/'/g, "\\'")}'`);
                return `z.enum([${escapedValues.join(', ')}])`;
            }
            return null;
        }

        function generateZodSchema(obj, name = 'schema') {
            const config = getConfig();
            detectedPatternsSet = new Set();

            const parse = (obj, seen, depth = 0) => {
                switch (typeof obj) {
                    case 'string':
                        return detectStringPattern(obj, config);

                    case 'number':
                        return parseNumber(obj, config);

                    case 'bigint':
                        return 'z.bigint()';

                    case 'boolean':
                        return 'z.boolean()';

                    case 'object':
                        if (obj === null) {
                            return 'z.null()';
                        }
                        if (obj instanceof Date) {
                            return config.coerceMode ? 'z.coerce.date()' : 'z.date()';
                        }
                        if (obj instanceof RegExp) {
                            return 'z.instanceof(RegExp)';
                        }
                        if (seen.find((_obj) => Object.is(_obj, obj))) {
                            throw new Error('Circular objects are not supported');
                        }
                        seen.push(obj);

                        if (Array.isArray(obj)) {
                            if (obj.length === 0) {
                                return 'z.array(z.unknown())';
                            }

                            // Check for tuple (different types at each position)
                            const typeAtPosition = obj.map((item) => parse(item, [...seen], depth + 1));
                            const uniqueTypes = [...new Set(typeAtPosition)];

                            // Try enum detection for string arrays
                            if (obj.every(item => typeof item === 'string')) {
                                const enumResult = detectEnumValues(obj);
                                if (enumResult) {
                                    detectedPatternsSet.add('Enum');
                                    let result = `z.array(${enumResult})`;
                                    if (config.nonemptyArrays && obj.length > 0) {
                                        result += '.nonempty()';
                                    }
                                    return result;
                                }
                            }

                            // Check if it's a tuple (2-5 fixed elements with different types)
                            if (obj.length >= 2 && obj.length <= 5 && uniqueTypes.length > 1) {
                                detectedPatternsSet.add('Tuple');
                                return `z.tuple([${typeAtPosition.join(', ')}])`;
                            }

                            // Regular array
                            if (uniqueTypes.length === 1) {
                                let result = `z.array(${uniqueTypes[0]})`;
                                if (config.nonemptyArrays && obj.length > 0) {
                                    result += '.nonempty()';
                                }
                                return result;
                            } else {
                                let result = `z.array(z.union([${uniqueTypes.join(', ')}]))`;
                                if (config.nonemptyArrays && obj.length > 0) {
                                    result += '.nonempty()';
                                }
                                return result;
                            }
                        }

                        // Object handling
                        const entries = Object.entries(obj).map(([k, v]) => {
                            const parsedValue = parse(v, [...seen], depth + 1);
                            // Handle nullable values
                            const valueStr = v === null ? 'z.null()' : parsedValue;
                            return `'${k}': ${valueStr}`;
                        });

                        let objectSchema = `z.object({ ${entries.join(', ')} })`;

                        if (config.strictMode) {
                            objectSchema += '.strict()';
                        }

                        return objectSchema;

                    case 'undefined':
                        return 'z.undefined()';

                    case 'function':
                        return 'z.function()';

                    case 'symbol':
                        return 'z.symbol()';

                    default:
                        return 'z.unknown()';
                }
            };

            const schemaBody = parse(obj, []);

            // Add .required() if enabled
            // Add .required() or .optional()
            let finalSchema = schemaBody;
            if (config.requiredMode) {
                finalSchema += '.required()';
            } else if (config.optionalMode) {
                finalSchema += '.optional()';
            }

            // Update detected patterns display
            updateDetectedPatternsDisplay();

            try {
                const formattedSchema = prettier.format(
                    `import { z } from "zod";\n\nexport const ${name} = ${finalSchema};`,
                    {
                        parser: 'babel',
                        plugins: prettierPlugins,
                        printWidth: 80,
                        tabWidth: 2,
                        semi: true,
                        singleQuote: true,
                    }
                );
                return formattedSchema;
            } catch (e) {
                // Fallback if prettier fails
                return `import { z } from "zod";\n\nexport const ${name} = ${finalSchema};`;
            }
        }

        function updateDetectedPatternsDisplay() {
            const panel = document.getElementById('detectedTypesPanel');
            const container = document.getElementById('detectedTypes');

            if (detectedPatternsSet.size > 0) {
                panel.classList.remove('hidden');
                container.innerHTML = [...detectedPatternsSet].map(pattern =>
                    `<span class="px-3 py-1 bg-gradient-to-r from-blue-500/20 to-purple-500/20 text-blue-700 dark:text-blue-300 rounded-full text-sm border border-blue-500/30">${pattern}</span>`
                ).join('');
            } else {
                panel.classList.add('hidden');
                container.innerHTML = '';
            }
        }

        function generateSchema() {
            const jsonInput = document.getElementById('jsonInput');
            const schemaOutput = document.getElementById('schemaOutput');
            const inputError = document.getElementById('inputError');

            try {
                const data = JSON.parse(jsonInput.value);
                inputError.textContent = '';
                const schema = generateZodSchema(data);
                schemaOutput.value = schema;
            } catch (error) {
                inputError.textContent = 'Invalid JSON: ' + error.message;
                schemaOutput.value = '';
                document.getElementById('detectedTypesPanel').classList.add('hidden');
            }
        }

        function loadExample() {
            const exampleJson = {
                "user": {
                    "id": "550e8400-e29b-41d4-a716-446655440000",
                    "email": "john.doe@example.com",
                    "phone": "+14155552671",
                    "age": 28,
                    "balance": 1250.75,
                    "isVerified": true,
                    "status": "active",
                    "ipAddress": "192.168.1.100",
                    "avatarColor": "#3B82F6",
                    "createdAt": "2024-01-15T10:30:00Z"
                },
                "preferences": {
                    "theme": "dark",
                    "locale": "en-US",
                    "notifications": true
                },
                "roles": ["admin", "user", "moderator"],
                "scores": [95, 87, 92, 88, 91],
                "mixedData": [1, "two", true],
                "metadata": {
                    "version": "2.1.0",
                    "apiToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0.dozjgNryP4J3jVmNHl0w5N_XgL0n3I9PlFUP0THsR8U",
                    "nested": {
                        "deep": {
                            "value": 42,
                            "timestamp": "2024-06-20T14:22:05.123Z"
                        }
                    }
                }
            };
            document.getElementById('jsonInput').value = JSON.stringify(exampleJson, null, 2);
            generateSchema();
        }

        function downloadSchema() {
            const schema = document.getElementById('schemaOutput').value;
            if (!schema) return;

            const blob = new Blob([schema], { type: 'text/typescript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'schema.ts';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function clearInputs() {
            document.getElementById('schemaOutput').value = '';
            document.getElementById('jsonInput').value = '';
            document.getElementById('inputError').textContent = '';
            document.getElementById('detectedTypesPanel').classList.add('hidden');
        }

        function copySchema() {
            const schemaOutput = document.getElementById('schemaOutput');
            if (!schemaOutput.value) return;

            navigator.clipboard.writeText(schemaOutput.value).then(() => {
                // Visual feedback
                const btn = event.target.closest('button');
                const originalText = btn.innerHTML;
                btn.innerHTML = '<span class="flex items-center gap-2"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>Copied!</span>';
                setTimeout(() => {
                    btn.innerHTML = originalText;
                }, 2000);
            }).catch(() => {
                // Fallback for older browsers
                schemaOutput.select();
                document.execCommand('copy');
            });
        }
    </script>
    <script>
        function toggleTheme() {
            if (localStorage.theme === 'dark') {
                localStorage.theme = 'light';
                document.documentElement.classList.remove('dark');
            } else {
                localStorage.theme = 'dark';
                document.documentElement.classList.add('dark');
            }
        }
    </script>
</body>

</html>
